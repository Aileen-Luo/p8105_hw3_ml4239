---
title: "p8105_hw3_ml4239"
Author: "Man Luo"
Date: 2018-10-15
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(tidyr)
library(ggridges)
library(patchwork)
library(ggExtra)
```

#P.1
data cleaning 
```{r}
# install.packages("devtools")
devtools::install_github("p8105/p8105.datasets")
library(p8105.datasets)
data("brfss_smart2010") 
brfss<-brfss_smart2010 %>% 
  janitor::clean_names() %>%  #format the data to use appropriate variable names;
  filter(topic == "Overall Health") %>% #focus on the “Overall Health” topic
  filter(response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>% #include only responses from “Excellent” to “Poor”
  mutate(response = forcats::fct_relevel(response, c("Excellent", "Very good", "Good", "Fair", "Poor"))) #organize responses as a factor taking levels ordered from “Excellent” to “Poor”
  str(brfss$response)
```

##1.1
In 2002, which states were observed at 7 locations?
```{r}
brfss%>% 
  filter(year == 2002) %>% 
  group_by(year,locationabbr) %>% 
  summarise(n_location = n_distinct(locationdesc)) %>% 
  filter(n_location == 7)
```

**Comments** In 2002, there are three states which were observed at 7 locations: CT, FL, NC

##1.2
Make a “spaghetti plot” that shows the number of locations in each state from 2002 to 2010.

```{r}
unique(brfss$year)
  brfss%>% 
    group_by(year,locationabbr) %>% 
    summarise(n_location = n_distinct(locationdesc)) %>% 
    ggplot(aes(x = year, y = n_location, color = locationabbr)) +
    geom_point() +
    geom_line() +
    labs(
    title = "Spaghetti plot of number of locations in each state from 2002 to 2010",
    x = "Year",
    y = "Number of locations"
  )
    
```

**Comments**the number of locations(distinct) in FL change the most from 2002 to 2010 expecially in 2007. In other states the distinct number of locations lies between 1 to 20 and do not change a lot.

##1.3
Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.


```{r}
brfss %>% 
  filter(year %in% c(2002,2006,2010) & locationabbr == "NY") %>% 
  filter(response == "Excellent") %>% 
  group_by(year) %>% 
  summarise(mean_excellent = mean(data_value, na.rm = T),
            sd_excellent = sd(data_value, na.rm = T)) %>% 
  knitr::kable(digits = 3)
```

**Comments**The mean proportions of “Excellent” responses across locations in NY State are quite similar between 2006 and 2010. And for 2002 the mean proportion is a little higher than 2006and 2010. The standard deviation of the proportion of “Excellent” responses across locations in NY State is the greatest for 2002, and 2010 has the lowest standart deviation.

##1.4
For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.

```{r}
brfss %>% 
  group_by(year, locationabbr, response) %>% 
  summarise(ave_proportion = mean(data_value)) %>% 
  ggplot(aes(x = year, y = ave_proportion, color = locationabbr))+
  geom_point()+
  geom_line()+
  facet_grid(~response) +
  labs(
    title = "Distribution of State-level Averages Proportion in Each Response for Each Year ",
    x = "Year",
    y = "Average proportion"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5,size = 8), legend.position = "right") 
  
```

**Comments**There are five clusters of data points in the spaghetti plots.The mean proportions of each response type have roughly the same center and range across states across years from 2002 to 2010.The distribution of average proportions of "Poor" responses has the least variation. The distribution of average proportions of "Very good" responses seems to have the greatest variation. 